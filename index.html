
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>事故地图</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .filter-container {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      z-index: 1000;
      padding: 10px;
      font-size: 14px;
      overflow: auto;
      max-height: 95%;
    }
    .leaflet-control-attribution { display: none; }
    .watermark {
      position: absolute;
      color: rgba(100, 100, 100, 0.3);
      font-size: 24px;
      font-weight: bold;
      pointer-events: none;
      z-index: 999;
    }
    .watermark.top-left { top: 30px; left: 30px; }
    .watermark.top-right { top: 30px; right: 30px; }
    .watermark.center { top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .watermark.bottom-left { bottom: 30px; left: 30px; }
    .watermark.bottom-right { bottom: 30px; right: 30px; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
</head>
<body>
<div id="map"></div>
<div class="filter-container">
  <input type="text" id="keyword" placeholder="关键词（概要/时间/损失/船舶）"><br>
  <button onclick="applyFilters()">确认</button><br><br>
  <label>事故类型: <select id="typeFilter"></select></label><br>
  <label>事故等级: <select id="levelFilter"></select></label><br>
  <label>是否浙江: <select id="zhejiangFilter"></select></label><br>
</div>
<div class="watermark top-left">陶越 CCSC 15168318167</div>
<div class="watermark top-right">陶越 CCSC 15168318167</div>
<div class="watermark.center">浙江省港航管理中心</div>
<div class="watermark bottom-left">陶越 CCSC 15168318167</div>
<div class="watermark bottom-right">陶越 CCSC 15168318167</div>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([29.5, 121], 6);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: ''
  }).addTo(map);

  let allMarkers = [];

  function loadData() {
    fetch('points.json')
      .then(response => response.json())
      .then(data => {
        allMarkers = [];
        const values = { type: new Set(), level: new Set(), zj: new Set() };
        data.features.forEach(f => {
          values.type.add(f.properties["事故类型"]);
          values.level.add(f.properties["事故等级"]);
          values.zj.add(f.properties["是否浙江"]);
          const marker = L.marker([f.geometry.coordinates[1], f.geometry.coordinates[0]]);
          marker.bindPopup(`
            <b>${f.properties["事故时间"] || ""}</b><br>
            ${f.properties["事故类型"] || ""} / ${f.properties["事故等级"] || ""}<br>
            ${f.properties["涉事船舶及其归属情况"] || ""}<br>
            ${f.properties["事故概要"] || ""}
          `);
          marker.feature = f;
          allMarkers.push(marker);
        });
        populateFilter('typeFilter', values.type);
        populateFilter('levelFilter', values.level);
        populateFilter('zhejiangFilter', values.zj);
        applyFilters();
      });
  }

  function populateFilter(id, values) {
    const select = document.getElementById(id);
    select.innerHTML = '<option value="">全部</option>';
    [...values].sort().forEach(v => {
      select.innerHTML += `<option value="${v}">${v}</option>`;
    });
  }

  function applyFilters() {
    const keyword = document.getElementById("keyword").value.trim();
    const type = document.getElementById("typeFilter").value;
    const level = document.getElementById("levelFilter").value;
    const zj = document.getElementById("zhejiangFilter").value;
    allMarkers.forEach(m => map.removeLayer(m));
    allMarkers.forEach(m => {
      const p = m.feature.properties;
      if (
        (type && p["事故类型"] !== type) ||
        (level && p["事故等级"] !== level) ||
        (zj && p["是否浙江"] !== zj)
      ) return;
      if (keyword && !JSON.stringify(p).includes(keyword)) return;
      m.addTo(map);
    });
  }

  loadData();
</script>
</body>
</html>
